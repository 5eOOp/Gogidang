<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	 
<mapper namespace="com.spring.mapper.ReviewMapper">

	<select id="getListWithPaging" resultType="ReviewVO">
		<![CDATA[
		select review_num, title, nickname, s_name, star, review_date
		from
			( 	select /*+ INDEX_DESC(review pk_review) */ 
					rownum rn, review_num, title, nickname, s_name, star, review_date
				from review
				where rownum <= #{pageNum} * #{amount} )
		where rn > (#{pageNum}-1) * #{amount}
		]]>
	</select>
	
	<insert id="reviewReg" parameterType="ReviewVO">
		<selectKey keyProperty="review_num" order="BEFORE" resultType="int">
			select seq_review.nextval from dual
		</selectKey>
		
		INSERT INTO review (review_num, u_id, nickname, s_num, s_name, title, content, star, photo1, photo2, photo3) 
		VALUES (#{review_num}, #{u_id}, #{nickname}, #{s_num}, #{s_name}, #{title}, #{content}, #{star}, #{photo1}, #{photo2}, #{photo3})
	</insert>
	
	<update id="update">
		update review
		set content = #{content}
		where review_num=#{review_num}
	</update>
	
	<delete id="delete">
		delete from review where review_num=#{review_num}
	</delete>
	
	<select id="read" resultType="ReviewVO">
		select * from review where review_num=#{review_num}
	</select>
	
	<select id="getTotalCount" resultType="int">
		select count(*) from review where review_num > 0
	</select>
</mapper>